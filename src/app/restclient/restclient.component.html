<app-navbar></app-navbar>
<h4>Spain Birth REST Client</h4>
<div class="row centered">
  <div class="col s1">
    <button class="tooltipped #4caf50 green btn-floating btn-large waves-effect waves-light" (click)="get()" data-position="top"
      data-delay="50" data-tooltip="List all births!">
      <i class="material-icons">view_list</i>
    </button>
  </div>
  <div class="col s1">
    <button class="tooltipped btn-floating btn-large waves-effect waves-light red" (click)="deleteAll()" data-position="top"
      data-delay="50" data-tooltip="Delete all births!">
      <i class="material-icons">delete</i>
    </button>
  </div>
  <div class="col s1">
    <button class="tooltipped #5d4037 brown darken-2 btn-floating btn-large waves-effect waves-light" (click)="loadInitialData()"
      data-position="top" data-delay="50" data-tooltip="Load an initial array of births!">
      <i class="material-icons">restore</i>
    </button>
  </div>
</div>
<!-- Error message -->
<div class="row">
  <div class="col s12 center-align">
    <div *ngIf="error" class="card-panel #f44336 red z-depth-0">{{status}} {{statusText}}</div>
  </div>
</div>
<!-- Search -->
<div class="row">
  <div class="col s2">
    <select materialize="material_select" [materializeSelectOptions]="limitList" #limit [(ngModel)]="limits" (change)="search(limit.value,offset.value,region.value,year.value,from.value,to.value)">
      <option value="">Entries</option>
      <option *ngFor="let l of limitList" value="{{l}}">{{l}}</option>
    </select>
  </div>
  <div class="col s1">
    <select materialize="material_select" [materializeSelectOptions]="offsetList" #offset [(ngModel)]="offsets" (change)="search(limit.value,offset.value,region.value,year.value,from.value,to.value)">
      <option selected value="">Page</option>
      <option *ngFor="let o of offsetList | filterUnique" value="{{o}}">{{o}}</option>
    </select>
  </div>
  <div class="col s2 offset-s4">
    <select materialize="material_select" [materializeSelectOptions]="regionList" #region [(ngModel)]="regions" (change)="search(limit.value,offset.value,region.value,year.value,from.value,to.value)">
      <option value="">Region</option>
      <option *ngFor="let r of (regionList | sortByString) | filterUnique" value="{{r}}">{{r}}</option>
    </select>
  </div>
  <div class="col s1">
    <select materialize="material_select" [materializeSelectOptions]="yearList" #year [(ngModel)]="years" (change)="search(limit.value,offset.value,region.value,year.value,from.value,to.value)">
      <option value="">Year</option>
      <option *ngFor="let y of (yearList | sortByNumber) | filterUnique" value="{{y}}">{{y}}</option>
    </select>
  </div>
  <div class="col s1">
    <select materialize="material_select" [materializeSelectOptions]="fromList" #from [(ngModel)]="froms" (change)="search(limit.value,offset.value,region.value,year.value,from.value,to.value)">
      <option value="">From</option>
      <option *ngFor="let f of (fromList | sortByNumber) | filterUnique" value="{{f}}">{{f}}</option>
    </select>
  </div>
  <div class="col s1">
    <select materialize="material_select" [materializeSelectOptions]="toList" #to [(ngModel)]="tos" (change)="search(limit.value,offset.value,region.value,year.value,from.value,to.value)">
      <option value="">To</option>
      <option *ngFor="let t of (toList | sortByNumber) | filterUnique" value="{{t}}">{{t}}</option>
    </select>
  </div>
</div>
<!-- Data table -->
<br />
<table border='1' rules="all" cellpadding="5" class="striped">
  <tr class="#42a5f5 blue lighten-1 z-depth-0">
    <td class="white-text center-align">Region</td>
    <td class="white-text center-align">Year</td>
    <td class="white-text center-align">Men</td>
    <td class="white-text center-align">Women</td>
    <td class="white-text center-align">Total Birth</td>
    <td colspan="2" class="white-text center-align">Actions</td>
  </tr>
  <!-- Post -->
  <tr class="white z-depth-0">
    <td>
      <input type="text" class="form-control" #newBirthRegion placeholder="Andalucia" />
    </td>
    <td>
      <input type="number" class="form-control" #newBirthYear placeholder="2009" />
    </td>
    <td>
      <input type="number" class="form-control" #newBirthMen placeholder="43243" />
    </td>
    <td>
      <input type="number" class="form-control" #newBirthWomen placeholder="43432" />
    </td>
    <td>
      <input type="number" class="form-control" #newBirthTotalBirth placeholder="473824" disabled value="{{newBirthMen.value -- newBirthWomen.value}}"
      />
    </td>
    <td colspan="2" class="center-align">
      <button class="btn-floating btn-large waves-effect waves-light blue" (click)="addBirth(
        newBirthRegion.value, 
        newBirthYear.value, 
        newBirthMen.value, 
        newBirthWomen.value, 
        newBirthMen.value -- newBirthWomen.value
      ); 
      newBirthRegion.value=''; 
      newBirthYear.value='';
      newBirthMen.value='';
      newBirthWomen.value='';
      newBirthTotalBirth.value=''">
        <i class="material-icons">add</i>
      </button>
    </td>
  </tr>
  <tr>
    <td colspan="5">
      <textarea #payload id="textarea1" name="payload" class="materialize-textarea" placeholder="region;year;men;women;totalbirth
Andalucía;2009;3232;3232;3232"></textarea>
      <label for="textarea1">Textarea for CSV</label>
    </td>
    <td>
      <button (click)="csv(payload.value);payload.value=''" class="tooltipped btn-floating btn-large waves-effect waves-light blue" data-position="top"
        data-delay="50" data-tooltip="Insert a .CSV text!">
        <i class="material-icons">add</i>
      </button>
    </td>
    <td>
      <label for="file-upload" class="tooltipped btn-floating btn-large waves-effect waves-light #9e9e9e grey" data-position="top"
        data-delay="50" data-tooltip="Load a .CSV!">
        <i class="material-icons">file_upload</i>
      </label>
      <input id="file-upload" type="file" (change)='convertFile()' materialize/>
    </td>
  </tr>
  <!-- Data -->
  <tr *ngFor="let birth of births | sort: 'year'" class="white z-depth-0">
    <td>{{birth.region}}</td>
    <td>{{birth.year}}</td>
    <td>{{birth.men}}</td>
    <td>{{birth.women}}</td>
    <td>{{birth.totalbirth}}</td>
    <td>
      <!-- Actions -->
      <a class="btn-floating btn-large waves-effect waves-light purple" routerLink="/RESTClient/{{birth.region}}/{{birth.year}}">
        <i class="material-icons">mode_edit</i>
      </a>
    </td>
    <td>
      <button class="btn-floating btn-large waves-effect waves-light #f44336 red" (click)="deleteBirth(
        birth.region,
        birth.year
        )">
        <i class="material-icons">delete</i>
      </button>
    </td>
  </tr>
</table>
<br />
<a routerLink="/data">« Previous</a>